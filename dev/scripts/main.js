/***************************************************************************
    Exemplo JSON vindo do Server
***************************************************************************/

var jsonOrgan = [{
    "id": 15,
    "cargo": "Presidente",
    "nome": "Talita Aquino",
    "idcargo": 1,
    "pai": 0
}, {
    "id": 16,
    "cargo": "Vice-Presidente",
    "nome": "Arnaldo Amésio",
    "idcargo": 2,
    "pai": 1
}, {
    "id": 17,
    "cargo": "Diretor de Suprimentos",
    "nome": "Amanda Jacinta",
    "idcargo": 3,
    "pai": 2
}, {
    "id": 21,
    "cargo": "Gerente Asia",
    "nome": "Bruno Capadosia",
    "idcargo": 7,
    "pai": 3
}, {
    "id": 20,
    "cargo": "Gerente de Implantações",
    "nome": "Carlos Padeiro",
    "idcargo": 6,
    "pai": 3
}, {
    "id": 19,
    "cargo": "Gerente de Operação",
    "nome": "Carla Monicota",
    "idcargo": 5,
    "pai": 3
}, {
    "id": 18,
    "cargo": "Inteligência e Desenv.",
    "nome": "Danilo Melado",
    "idcargo": 4,
    "pai": 3
}, {
    "id": 44,
    "cargo": "Inteligência e Desenv.",
    "nome": "Daniel Mamosa",
    "idcargo": 31,
    "pai": 5
}, {
    "id": 45,
    "cargo": "Suprimentos Planej e Qualidade",
    "nome": "Efanasio Aleluia",
    "idcargo": 34,
    "pai": 5
}, {
    "id": 46,
    "cargo": "Planning Control",
    "nome": "Gatuso Armelio",
    "idcargo": 35,
    "pai": 5
}, {
    "id": 26,
    "cargo": "Suprimentos EMEA",
    "nome": "Helio Apogrado",
    "idcargo": 11,
    "pai": 5
}, {
    "id": 22,
    "cargo": "Suprimentos América do Sul",
    "nome": "Juliano Herdeiro",
    "idcargo": 8,
    "pai": 5
}, {
    "id": 28,
    "cargo": "Suprimentos Ásia",
    "nome": "Gustavo Nascimento",
    "idcargo": 13,
    "pai": 5
}, {
    "id": 23,
    "cargo": "Supr.Est.Bra/Amer",
    "nome": "Rodolfo do Sol",
    "idcargo": 9,
    "pai": 5
}, {
    "id": 27,
    "cargo": "Suprimentos América do Norte",
    "nome": "Marcos Fusco",
    "idcargo": 12,
    "pai": 5
}, {
    "id": 25,
    "cargo": "Supr.Est.Bra/Amer",
    "nome": "Marcelo Padeco",
    "idcargo": 10,
    "pai": 5
}, {
    "id": 60,
    "cargo": "Supr. Estrat. Serviços e VLI",
    "nome": "Mariano da Silva",
    "idcargo": 54,
    "pai": 6
}, {
    "id": 53,
    "cargo": "Suprim Est Americas Proj Ferrosos e Log",
    "nome": "Natassya Câmara",
    "idcargo": 47,
    "pai": 6
}, {
    "id": 54,
    "cargo": "Grandes Contratos de Obras Civis",
    "nome": "Izabel Fernandes",
    "idcargo": 48,
    "pai": 6
}, {
    "id": 55,
    "cargo": "Suprimentos de Equip. e Sistemas",
    "nome": "Papito Aquino",
    "idcargo": 49,
    "pai": 6
}, {
    "id": 56,
    "cargo": "Supr. Estrat. Europa, OM e Africa",
    "nome": "Luana Davilla",
    "idcargo": 50,
    "pai": 6
}, {
    "id": 58,
    "cargo": "Suprimentos Projetos Asia/Pacifico",
    "nome": "Marco Bonilha",
    "idcargo": 52,
    "pai": 6
}, {
    "id": 59,
    "cargo": "Supr. Estrat. Siderurgia, Energia",
    "nome": "Tamara Rasata",
    "idcargo": 53,
    "pai": 6
}, {
    "id": 57,
    "cargo": "Supr. Estrat. Americas",
    "nome": "Rafael Mulio",
    "idcargo": 51,
    "pai": 6
}, {
    "id": 71,
    "cargo": "Desenv Proj Fer Australia",
    "nome": "Morina Yoda",
    "idcargo": 70,
    "pai": 7
}, {
    "id": 72,
    "cargo": "Projetos China",
    "nome": "Antonio Gablad",
    "idcargo": 71,
    "pai": 7
}, {
    "id": 32,
    "cargo": "Suprimentos Siderurgia",
    "nome": "Pablo Huio",
    "idcargo": 17,
    "pai": 8
}, {
    "id": 29,
    "cargo": "Corredor Sul/Sudeste",
    "nome": "Rodrigo Jucano",
    "idcargo": 14,
    "pai": 8
}, {
    "id": 30,
    "cargo": "Planejamento e Gestão",
    "nome": "Silvia Betrone",
    "idcargo": 15,
    "pai": 8
}, {
    "id": 31,
    "cargo": "Corredor Norte",
    "nome": "Wagner Eastoin",
    "idcargo": 16,
    "pai": 8
}, {
    "id": 35,
    "cargo": "Suprimentos Categ Ferrovia",
    "nome": "André Gresatano",
    "idcargo": 22,
    "pai": 9
}, {
    "id": 34,
    "cargo": "Suprimentos Categ. Mineração",
    "nome": "Roberio Poilonio",
    "idcargo": 21,
    "pai": 9
}, {
    "id": 33,
    "cargo": "Suprimentos Aftermarket",
    "nome": "Alexandre Wasaby",
    "idcargo": 20,
    "pai": 9
}, {
    "id": 37,
    "cargo": "Processos de Operação",
    "nome": "Alex Uvono",
    "idcargo": 24,
    "pai": 10
}, {
    "id": 36,
    "cargo": "Supr Cat Combust E Insumos",
    "nome": "Felipe Jumiou",
    "idcargo": 23,
    "pai": 10
}, {
    "id": 38,
    "cargo": "Suprim Categoria Insumos",
    "nome": "Andre da Silva",
    "idcargo": 25,
    "pai": 10
}, {
    "id": 43,
    "cargo": "GA Suprimentos",
    "nome": "Juscelino Ribeiro",
    "idcargo": 30,
    "pai": 11
}, {
    "id": 42,
    "cargo": "Strategic Procurement",
    "nome": "Alexander Quoiton",
    "idcargo": 29,
    "pai": 12
}, {
    "id": 39,
    "cargo": "Nova Caledônia",
    "nome": "Namires Hakoio",
    "idcargo": 26,
    "pai": 13
}, {
    "id": 41,
    "cargo": "Indonésia",
    "nome": "Estônio Siajom",
    "idcargo": 28,
    "pai": 13
}, {
    "id": 40,
    "cargo": "Austrália",
    "nome": "Felipe Buloca",
    "idcargo": 27,
    "pai": 13
}, {
    "id": 49,
    "cargo": "Desenv de Suprimentos",
    "nome": "Miranda Lernia",
    "idcargo": 38,
    "pai": 31
}, {
    "id": 48,
    "cargo": "Estratégia de Cadeia de Suprimentos",
    "nome": "Mauricio Tokio",
    "idcargo": 37,
    "pai": 31
}, {
    "id": 47,
    "cargo": "Portfolio Fornecedores",
    "nome": "Larissa Jurtiomo",
    "idcargo": 36,
    "pai": 31
}, {
    "id": 52,
    "cargo": "Plan Suprim Proj Nacionais",
    "nome": "Holga Rasatin",
    "idcargo": 46,
    "pai": 34
}, {
    "id": 51,
    "cargo": "Planej Suprim De Recursos",
    "nome": "Jascinto Moreira",
    "idcargo": 45,
    "pai": 34
}, {
    "id": 50,
    "cargo": "Administrativa Suprimentos",
    "nome": "Guilherme Eranol",
    "idcargo": 44,
    "pai": 34
}, {
    "id": 63,
    "cargo": "Suprim Logistica Brasil",
    "nome": "Vanessa Elopaco",
    "idcargo": 58,
    "pai": 47
}, {
    "id": 62,
    "cargo": "Suprim Proj Ferrosos Norte",
    "nome": "Valéria Wasakio",
    "idcargo": 56,
    "pai": 47
}, {
    "id": 61,
    "cargo": "Suprim Proj Ferrosos Sul",
    "nome": "Gana Caxa",
    "idcargo": 55,
    "pai": 47
}, {
    "id": 64,
    "cargo": "Suprimentos Proj. Australia",
    "nome": "Lola Juno",
    "idcargo": 59,
    "pai": 50
}, {
    "id": 66,
    "cargo": "Suprimentos Proj Malasia",
    "nome": "Marisa Zarolho",
    "idcargo": 61,
    "pai": 50
}, {
    "id": 67,
    "cargo": "Suprim Moçambique e Malawi",
    "nome": "Guilhermina Jagda",
    "idcargo": 62,
    "pai": 50
}, {
    "id": 65,
    "cargo": "Supr Estr Gr Cont OB CV AF",
    "nome": "Renata Regojo",
    "idcargo": 60,
    "pai": 50
}, {
    "id": 68,
    "cargo": "Suprim Constr e Mont.",
    "nome": "Morana Resahio",
    "idcargo": 65,
    "pai": 54
}, {
    "id": 69,
    "cargo": "Supr Vale Log Integrada",
    "nome": "Ana Doprado",
    "idcargo": 66,
    "pai": 54
}, {
    "id": 70,
    "cargo": "Supr Proj Correntes",
    "nome": "Keila Gonçalvez",
    "idcargo": 68,
    "pai": 54
}];


var $organogramaEx = $("#organograma-exemplo"),
    fnShowHide,
    fnOffset,
    fnTamanhoHorizontal;

/***************************************************************************
    Criação do fluxograma no DOM
***************************************************************************/

(function createDOM() {
    var ul, li, div, docfrag, i = 0;
    for (var property in jsonOrgan) {
        if (jsonOrgan.hasOwnProperty(property)) {
            if (!document.getElementById("ul-" + jsonOrgan[property].pai)) {
                docfrag = document.createDocumentFragment();
                i++;
                if (i > 2) {
                    //var divZoom
                    //<div class="zoom mais"></div>
                    divZoom = document.createElement("div");
                    divZoom.setAttribute("class", "zoom mais");

                    //var divBarraHorizontal
                    //<div class="barrahorizontal"></div>
                    divBarraHorizontal = document.createElement("div");
                    divBarraHorizontal.setAttribute("class","barrahorizontal");
                    divZoom.appendChild(divBarraHorizontal);

                    //var divBarraVertical
                    //<div class="barravertical"></div>
                    divBarraVertical = document.createElement("div");
                    divBarraVertical.setAttribute("class","barravertical");
                    divZoom.appendChild(divBarraVertical);

                    //var divZoom
                    // <div class="zoom mais">
                        // <div class="barrahorizontal"></div>
                        // <div class="barravertical"></div>
                    // </div>

                    docfrag.appendChild(divZoom)
                }

                //var ul
                //<ul id="ul-" + jsonOrgan[property].pai" class="hide"></ul>
                ul = document.createElement("ul");
                ul.setAttribute("id", "ul-" + jsonOrgan[property].pai);
                ul.setAttribute("class", "hide");
                docfrag.appendChild(ul);

                document.getElementById("li-" + jsonOrgan[property].pai).appendChild(docfrag)
            }

            //var li
            //<li id="li-" + jsonOrgan[property].idcargo></li>
            li = document.createElement("li");
            li.setAttribute("id", "li-" + jsonOrgan[property].idcargo);
            document.getElementById("ul-" + jsonOrgan[property].pai).appendChild(li).innerHTML = '<div class="wrap-infos wrap-infos-padrao">' + '<p class="nome">' + jsonOrgan[property].nome + "</p>" + '<p class="cargo">' + jsonOrgan[property].cargo + "</p>" + "</div>"
        }
    }
})();

/***************************************************************************
    Tamanho horizontal (scrollbar) da tela
 ***************************************************************************/

fnTamanhoHorizontal = function () {
    var l = [];
    $organogramaEx
        .css("width", 10000);
    $organogramaEx
        .find("ul")
        .not(".hide")
        .each(function(i) {
            l[i] = $(this).width()
    });
    l.sort(function(a, b) {
        return a - b
    });
    l.pop();
    $organogramaEx
        .css("width", l.pop())
}

/***************************************************************************
    Click nos Botões de Zoom
***************************************************************************/

fnShowHide = function(element) {
    element
        .toggleClass("mais")
        .toggleClass("menos");
    element
        .siblings("ul")
        .toggleClass("hide");
    $(".hightlight")
        .removeClass("hightlight");
    element
        .prevAll(".wrap-infos")
        .addClass("hightlight");
};


/***************************************************************************
    Alinhando o ramo ativo mais próximo do centro da tela.
   ***************************************************************************/

fnOffset = function($btn) {
    var l, t;
    l = $btn
            .prevAll(".wrap-infos")
            .offset()
            .left;
    t = $btn
            .prevAll(".wrap-infos")
            .offset()
            .top;

    setTimeout(function() {
        $(document).scrollLeft(l - $(window).width() / 2 + 60);
        $(document).scrollTop(t)
    }, 25)
};

$organogramaEx.find(".zoom").each(function() {
    var $thisButton = $(this);
    $thisButton.on("click", function() {
        fnShowHide($thisButton);
        fnTamanhoHorizontal();
        fnOffset($thisButton)
    })
});

$("#organograma-infos").find(".zoom").each(function() {
    var $thisButton = $(this);
    $thisButton.on("click", function() {
        fnShowHide($thisButton)
    })
});

/***************************************************************************
    Seletores Adicionais
   ***************************************************************************/

$(".organograma li:last-child")
	.addClass("ultimo-filho");
$(".organograma li:only-child")
	.addClass("filho-unico");

/***************************************************************************
    Ramos a mostrar logo após carregamento da página
   ***************************************************************************/

$("#ul-1,#ul-2")
	.removeClass("hide");

fnTamanhoHorizontal();